<!DOCTYPE html>
<html class="scroll-smooth">
<head>
    <meta charset="UTF-8" />
    <title>Pictures</title>
    <link rel="stylesheet" href="/css/style.css" />
</head>
<body class="bg-gray-100 min-h-screen p-4 bg-dottore">
    <div class="max-w-3xl mx-auto bg-white shadow-lg rounded-lg p-8 m-4">
        <h1 class="text-2xl font-bold mb-4 text-rose-950">List of Pictures</h1>

        <form method="GET" action="/photos" class="mb-4">
        <input
            id="search"
            type="text"
            name="q"
            value="<%= query %>"
            placeholder="Find..."
            class="w-full border border-gray-300 px-3 py-2 rounded focus:outline-none focus:ring-1 focus:ring-rose-300"
        />
        </form>

        <% if (photos.length === 0) { %>
        <p class="text-gray-500">Nothing.</p>
        <% } %>

        <div id="photo-list" class="space-y-4 mt-4">
        <% photos.forEach(photo => { %>
            <div class="photo-card border border-gray-200 rounded p-4 bg-gray-50 
            transition-all duration-300 ease-out
            opacity-0 translate-y-2 scale-95
            hover:shadow-sm hover:-translate-y-0.5"
            data-title="<%= (photo.title || '').toLowerCase() %>"
            data-desc="<%= (photo.description || '').toLowerCase() %>">
                <img
                    src="/image?key=<%= encodeURIComponent(photo.object_key) %>"
                    alt="<%= photo.title %>"
                    class="w-full max-h-64 object-cover rounded-md mb-4"
                />
                <h2 class="text-lg font-semibold text-gray-800 break-words"><%= photo.title %></h2>
                <p class="text-gray-700 mb-1 break-words"><%= photo.description %></p>
                <p class="text-xs text-gray-500 break-words">
                    Object Key: <%= photo.object_key %>
                </p>
                <p class="text-xs text-gray-500 break-words">
                    Uploaded at: <%= photo.uploaded_at %>
                </p>
            </div>
        <% }) %>
        </div>

        <a href="/upload" class="block mt-6 text-rose-700 hover:underline">
            Back to Upload page? Click here!
        </a>
    </div>

    <script>
    const input = document.getElementById("search");
    const cards = Array.from(document.querySelectorAll(".photo-card"));

    function showCard(card) {
        card.style.display = "";
        // kasih jeda 1 frame supaya transisi jalan
        requestAnimationFrame(() => {
        card.classList.remove("opacity-0", "translate-y-2", "scale-95");
        card.classList.add("opacity-100", "translate-y-0", "scale-100");
        });
    }

    function hideCard(card) {
        card.classList.remove("opacity-100", "translate-y-0", "scale-100");
        card.classList.add("opacity-0", "translate-y-2", "scale-95");
        setTimeout(() => {
        card.style.display = "none";
        }, 200);
    }

    window.addEventListener("DOMContentLoaded", () => {
        cards.forEach((card, i) => {
        setTimeout(() => showCard(card), i * 60);
        });
    });

    input.addEventListener("input", () => {
        const q = input.value.trim().toLowerCase();

        if (q === "") {
            cards.forEach(card => showCard(card));
            return;
        }

        cards.forEach(card => {
        const haystack =
            (card.dataset.title || "") + " " +
            (card.dataset.desc || "") + " " +
            (card.dataset.tags || "");

        const match = haystack.includes(q);

        if (match) showCard(card);
        else hideCard(card);
        });
    });
    </script>
</body>
</html>
